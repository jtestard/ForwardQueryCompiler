<?xml version="1.0" encoding="UTF-8"?>
<test_case>
    <action_statement>
        <![CDATA[
            CREATE ACTION catch_exception2(username_input string) as
            DECLARE
                null_value integer;
            BEGIN
                /* This creates a temporary schema object (we need this to properly reproduce the error) */
                DELETE FROM  jdbc.executed_query_patterns as eqp
                WHERE   username = username_input;
                
                /* This throws the exception (query_id cannot be null)*/
                UPDATE jdbc.executed_query_patterns as eqp
                SET query_id = null_value;
            END;
        ]]>
    </action_statement>
    <query_expression>
        catch_exception2('erick');
    </query_expression>
    <data_source name="jdbc" storage_system="JDBC">
        <properties environment="jenkins" overwrite="true" user="postgres" password="postgres" maxPoolSize="20"
            unreturnedConnectionTimeout="0" debugUnreturnedConnectionStackTraces="true" driver="postgresql" host="localhost" port="5432"
            database="forward" schema="public" />
        <properties environment="testing" overwrite="true" user="postgres" password="postgres" maxPoolSize="20"
            unreturnedConnectionTimeout="0" debugUnreturnedConnectionStackTraces="true" driver="postgresql" host="localhost" port="5432"
            database="forward" schema="public" />
        <properties environment="development" overwrite="true" user="postgres" password="postgres" maxPoolSize="20"
            unreturnedConnectionTimeout="0" debugUnreturnedConnectionStackTraces="true" driver="postgresql" host="localhost" port="5432"
            database="forward" schema="public" />
    </data_source>
    <data_object name="executed_query_patterns" execution_data_source="jdbc" cardinality_estimate="LARGE">
        <schema_tree>
            <root type="collection">
                <element type="tuple">
                    <query_id type="integer" />
                    <username type="string"/>
                </element>
                <constraints>
                    <local-key collection="/">
                        <attribute path="tuple/query_id" />
                    </local-key>
                    <non-null />
                </constraints>
            </root>
        </schema_tree>
        <data_tree>
            <root>
                <element>
                    <query_id>1</query_id>
                    <username>erick</username>
                </element>
                <element>
                    <query_id>2</query_id>
                    <username>bob</username>
                </element>
            </root>
        </data_tree>
    </data_object>
</test_case>